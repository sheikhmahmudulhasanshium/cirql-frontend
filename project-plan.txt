Project Cirql - v1.2.0 Development Summary
Primary Objective: To implement a secure, two-step 2FA login system and build a dynamic, full-featured notification platform.
I. Backend Implementation & Fixes (NestJS)
1. Secure 2FA Authentication Flow:
We hardened the entire login process for users with 2FA enabled.
POST /auth/login: Now returns a short-lived, restricted partial access token if 2FA is required, instead of just a status message.
POST /auth/2fa/verify-code: This endpoint is now protected by a new Jwt2faGuard, requiring the partial token. It no longer accepts a userId in the body; the user is securely identified from the token itself.
Google OAuth & 2FA: The flow was updated to correctly trigger the 2FA step after a successful Google sign-in, returning the partial access token to the frontend for the verification step.
Security: Brute-force protection was implemented, locking an account for 24 hours after 5 failed OTP attempts. The OTP lifespan was reduced to 2 minutes.
2. Dynamic Notification & Email System:
New Automated Triggers:
Admin Alerts: Admins now receive both in-app and email notifications for any new support ticket or ban appeal.
User Alerts: Users now receive in-app notifications when a ban is lifted or when another user follows them.
Welcome Back: A "Welcome Back" notification and email are now sent to users who log in after 30+ days of inactivity.
System-Wide Integration:
Announcements: Creating a new visible announcement now automatically generates a global in-app notification for all users and an email for those subscribed.
Critical Alerts: Critical emails (security, bans, etc.) are guaranteed to be sent, bypassing user-level unsubscription settings.
Schema & Type Safety: We updated the NotificationType enum with new types and adjusted the Mongoose schemas (Ticket, Announcement) to resolve all TypeScript and ESLint errors related to type inference, population, and unsafe method calls. This included using .equals() for safe ObjectId comparison and adding virtual properties for safe string ID access.
II. Frontend Implementation & Fixes (Next.js / React)
1. 2FA Login UI & Logic:
app/(routes)/log-in/page.tsx: Updated to correctly handle the new partialAccessToken response from the backend, dispatching a SET_PARTIAL_LOGIN action to the AuthContext.
app/(routes)/log-in/2fa/page.tsx: A new page was created to handle the OTP verification step. It uses the stored partial token to securely call the verification endpoint.
2. Dynamic Notification System:
Global State Management (NotificationContext.tsx): We introduced a new global NotificationProvider to manage the unread notification count across the entire application. This provider is wrapped around the app in app/layout.tsx.
use-notification-actions.ts Hook: Created a new hook to centralize API calls for marking notifications as read (individually or all at once).
NotificationBell Component: This component was completely refactored to:
Use the useNotificationContext to display the real-time unreadCount.
Include a "Mark all as read" button.
Trigger handleMarkAsRead when a notification in the dropdown is clicked, ensuring the count updates immediately.
NotificationCard Component: This component now also uses the useNotificationContext to call handleMarkAsRead when a user clicks on a notification link.
3. Bug Fixes & UX Improvements:
Settings Page Loading: We implemented a minimum delay for the loading skeleton on the settings page to prevent a jarring flash of an error message on fast connections.
Component & Hook Corrections: Fixed numerous import path errors, addressed duplicate component definitions (HomePage logic was merged into Body), and corrected props being passed to components (StatCard, UpdateAnnouncementModal).
Type Definitions (lib/types.ts): The frontend type definitions were synchronized with all the new backend enums and interfaces.
This summary captures the full scope of our work. I am ready to analyze your test results when you are.

test log
I can't go to /notifications page every time redirected to home page

Error: [apiClient] Response Error: 400 for /settings/me {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)
    at async updateMySettings (http://localhost:3000/_next/static/chunks/_2edb9341._.js:822:22)
    at async handleThemeChange (http://localhost:3000/_next/static/chunks/_2edb9341._.js:878:13)

AxiosError: Request failed with status code 400
    at settle (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:4337:16)
    at XMLHttpRequest.onloadend (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:4841:224)
    at Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5566:49)
    at async updateMySettings (http://localhost:3000/_next/static/chunks/_2edb9341._.js:822:22)
    at async handleThemeChange (http://localhost:3000/_next/static/chunks/_2edb9341._.js:878:13)
    Error: [apiClient] Response Error: 400 for /settings/me {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)
    at async updateMySettings (http://localhost:3000/_next/static/chunks/_2edb9341._.js:822:22)
    at async Body.useMemo[debouncedSaveSettings] (http://localhost:3000/_next/static/chunks/_4a08546a._.js:3296:47)
    AxiosError: Request failed with status code 400
    at settle (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:4337:16)
    at XMLHttpRequest.onloadend (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:4841:224)
    at Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5566:49)
    at async updateMySettings (http://localhost:3000/_next/static/chunks/_2edb9341._.js:822:22)
    at async Body.useMemo[debouncedSaveSettings] (http://localhost:3000/_next/static/chunks/_4a08546a._.js:3296:47)
    
    when i try to sign-in with a account with 2fa enabled got redirected to sign-in again
    but I got otp mail successfully. but couldn't test due to redirection to sign-in instead of login/2fa page.
    I got appeal notification both by email and notification but redirected me to http://localhost:3000/admin/support/685f075b98a461cd396f28e0
    which does not exists it should be http://localhost:3000/contacts/685f075b98a461cd396f28e0
    did not get message from admin ensuring user's account will be unbanned
    ilable locally at: http://localhost:3001/api   
Favicon should be available locally at: http://localhost:3001/favicon.ico
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseCoreModule dependencies initialized +17ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +6ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] MongooseModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] AuditModule dependencies initialized +5ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] SettingsModule dependencies initialized +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] NotificationsModule dependencies initialized +2ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] UsersModule dependencies initialized +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] AnnouncementsModule dependencies initialized +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] SocialModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] SupportModule dependencies initialized +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [InstanceLoader] AuthModule dependencies initialized +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] AppController {/}: +26ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/, GET} route +3ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] AuditController {/audit}: +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/audit, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] UsersController {/users}: +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/analytics, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/directory, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/profile/me, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/:id, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/profile/me, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/:id/roles, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/:id/ban, PATCH} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/:id/unban, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/:id, PATCH} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/users/:id, DELETE} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] NotificationsController {/notifications}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/notifications, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/notifications/unread-count, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/notifications/read/all, PATCH} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/notifications/read/batch, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/notifications/:id/read, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] AuthController {/auth}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/login, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/2fa/verify-code, POST} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/2fa/enable, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/2fa/disable, POST} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/google, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/google/callback, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/forgot-password, POST} route +2ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/reset-password, POST} route +2ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/logout, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/auth/status, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] SettingsController {/settings}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/settings/me, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/settings/user/:userId, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/settings/me, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/settings/me, DELETE} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] SocialController {/social}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/block/:userIdToBlock, POST} route +0ms        
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/unblock/:userIdToUnblock, DELETE} route +1ms  
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/profile/me, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/profile/:userId, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] FriendsController {/social/friends}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/friends/request, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/friends/requests/:requestId/accept, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/friends/requests/:requestId/reject, PATCH} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/friends/:friendId, DELETE} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/friends/list, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/friends/requests/pending, GET} route +1ms     
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] FollowersController {/social}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/follow/:userIdToFollow, POST} route +1ms      
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/unfollow/:userIdToUnfollow, DELETE} route +0ms[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/users/:userId/followers, GET} route +0ms      
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/users/:userId/following, GET} route +1ms      
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] GroupsController {/social/groups}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/groups, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/groups/:groupId, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/groups/:groupId/members, POST} route +1ms     
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/groups/:groupId/members/:memberId, DELETE} route +2ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/groups/:groupId, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/social/groups/:groupId, DELETE} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] RecommendationsController {/social/recommendations}: +0ms     
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] AnnouncementsController {/announcements}: +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/announcements, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/announcements, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/announcements/:id, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/announcements/:id, PATCH} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/announcements/:id, DELETE} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RoutesResolver] SupportController {/support}: +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/public-ticket, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/appeal-ticket, POST} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/tickets, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/tickets/:id/messages, POST} route +1ms       
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/tickets/:id/seen, POST} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/tickets, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/tickets/:id, GET} route +0ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/admin/tickets, GET} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [RouterExplorer] Mapped {/support/tickets/:id/close, PATCH} route +1ms
[Nest] 11116  - 06/28/2025, 1:29:04 AM     LOG [NestApplication] Nest application successfully started +4ms
[Nest] 11116  - 06/28/2025, 2:49:32 AM   DEBUG [GoogleStrategy] Validating Google profile for: Sheikh Mahmudul Hasan Shium Shium
[Nest] 11116  - 06/28/2025, 2:49:32 AM     LOG [AuthService] Validating OAuth login for email: sheikhmahmudulhasanshium2000@gmail.com
[Nest] 11116  - 06/28/2025, 2:52:37 AM     LOG [SupportService] Ticket 685de2699301179f8e91e236 marked as seen by user 685de0739301179f8e91e207
[Nest] 11116  - 06/28/2025, 2:52:38 AM     LOG [SupportService] Ticket 685de2699301179f8e91e236 marked as seen by user 685de0739301179f8e91e207
[Nest] 11116  - 06/28/2025, 2:55:26 AM   DEBUG [GoogleStrategy] Validating Google profile for: CiRQL Team
[Nest] 11116  - 06/28/2025, 2:55:26 AM     LOG [AuthService] Validating OAuth login for email: contact.cirql@gmail.com        
[Nest] 11116  - 06/28/2025, 2:55:30 AM     LOG [EmailService] Email sent successfully to: contact.cirql@gmail.com
[Nest] 11116  - 06/28/2025, 2:55:46 AM   DEBUG [GoogleStrategy] Validating Google profile for: CiRQL Team
[Nest] 11116  - 06/28/2025, 2:55:46 AM     LOG [AuthService] Validating OAuth login for email: contact.cirql@gmail.com        
[Nest] 11116  - 06/28/2025, 2:55:52 AM     LOG [EmailService] Email sent successfully to: contact.cirql@gmail.com
[Nest] 11116  - 06/28/2025, 2:57:10 AM   DEBUG [GoogleStrategy] Validating Google profile for: Sheikh Mahmudul Hasan Shium    
[Nest] 11116  - 06/28/2025, 2:57:10 AM     LOG [AuthService] Validating OAuth login for email: officials.shium@gmail.com      
[Nest] 11116  - 06/28/2025, 3:00:47 AM     LOG [EmailService] Email sent successfully to: sheikhmahmudulhasanshium2000@gmail.com
[Nest] 11116  - 06/28/2025, 3:03:29 AM   DEBUG [GoogleStrategy] Validating Google profile for: Sheikh Mahmudul Hasan Shium Shium
[Nest] 11116  - 06/28/2025, 3:03:29 AM     LOG [AuthService] Validating OAuth login for email: sheikhmahmudulhasanshium2000@gmail.com
[Nest] 11116  - 06/28/2025, 3:04:28 AM     LOG [NotificationsService] Creating notification for user 685dda68ec8db1f8851fa9a0 
[Nest] 11116  - 06/28/2025, 3:04:28 AM     LOG [NotificationsService] Creating notification for user 685ddd458fa7d6a5fa5e453d 
[Nest] 11116  - 06/28/2025, 3:04:31 AM     LOG [EmailService] Email sent successfully to: contact.cirql@gmail.com
[Nest] 11116  - 06/28/2025, 3:07:32 AM   DEBUG [GoogleStrategy] Validating Google profile for: Sheikh Mahmudul Hasan Shium    
[Nest] 11116  - 06/28/2025, 3:07:32 AM     LOG [AuthService] Validating OAuth login for email: officials.shium@gmail.com      
[Nest] 11116  - 06/28/2025, 3:09:43 AM     LOG [SupportService] Ticket 685f075b98a461cd396f28e0 marked as seen by user 685ddd458fa7d6a5fa5e453d
[Nest] 11116  - 06/28/2025, 3:09:44 AM     LOG [SupportService] Ticket 685f075b98a461cd396f28e0 marked as seen by user 685ddd458fa7d6a5fa5e453d
[Nest] 11116  - 06/28/2025, 3:11:26 AM   ERROR [ExceptionsHandler] MongoServerSelectionError: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net
    at Topology.selectServer (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\sdam\topology.ts:628:30)
    at async tryOperation (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\operations\execute_operation.ts:264:16)
    at async executeOperation (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\operations\execute_operation.ts:115:12)        
    at async FindCursor._initialize (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cursor\find_cursor.ts:92:22)
    at async FindCursor.cursorInit (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cursor\abstract_cursor.ts:944:21)
    at async FindCursor.fetchBatch (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cursor\abstract_cursor.ts:982:7)
    at async FindCursor.next (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cursor\abstract_cursor.ts:612:9)
    at async Collection.findOne (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\collection.ts:525:17)
    at async model.Query._findOne (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongoose@8.15.1\node_modules\mongoose\lib\query.js:2687:15)
    at async model.Query.exec (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongoose@8.15.1\node_modules\mongoose\lib\query.js:4604:63) {
  errorLabelSet: Set(0) {},
  reason: TopologyDescription {
    type: 'ReplicaSetNoPrimary',
    servers: Map(3) {
      'ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net:27017' => ServerDescription {
        address: 'ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net:27017',
        type: 'Unknown',
        hosts: [],
        passives: [],
        arbiters: [],
        tags: {},
        minWireVersion: 0,
        maxWireVersion: 0,
        roundTripTime: -1,
        minRoundTripTime: 0,
        lastUpdateTime: 22622345,
        lastWriteDate: 0,
        error: MongoNetworkError: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net
            at TLSSocket.<anonymous> (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cmap\connect.ts:394:16)
            at Object.onceWrapper (node:events:633:26)
            at TLSSocket.emit (node:events:518:28)
            at emitErrorNT (node:internal/streams/destroy:170:8)
            at emitErrorCloseNT (node:internal/streams/destroy:129:3)
            at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
          errorLabelSet: Set(1) {
            'ResetPool'
          },
          beforeHandshake: false,
          [cause]: Error: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net
              at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {
            errno: -3008,
            code: 'ENOTFOUND',
            syscall: 'getaddrinfo',
            hostname: 'ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net'
          }
        },
        topologyVersion: null,
        setName: null,
        setVersion: null,
        electionId: null,
        logicalSessionTimeoutMinutes: null,
        maxMessageSizeBytes: null,
        maxWriteBatchSize: null,
        maxBsonObjectSize: null,
        primary: null,
        me: null,
        '$clusterTime': null,
        iscryptd: false
      },
      'ac-9ru3epx-shard-00-02.vvozqg2.mongodb.net:27017' => ServerDescription {
        address: 'ac-9ru3epx-shard-00-02.vvozqg2.mongodb.net:27017',
        type: 'Unknown',
        hosts: [],
        passives: [],
        arbiters: [],
        tags: {},
        minWireVersion: 0,
        maxWireVersion: 0,
        roundTripTime: -1,
        minRoundTripTime: 0,
        lastUpdateTime: 22622345,
        lastWriteDate: 0,
        error: MongoNetworkError: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-02.vvozqg2.mongodb.net
            at TLSSocket.<anonymous> (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cmap\connect.ts:394:16)
            at Object.onceWrapper (node:events:633:26)
            at TLSSocket.emit (node:events:518:28)
            at emitErrorNT (node:internal/streams/destroy:170:8)
            at emitErrorCloseNT (node:internal/streams/destroy:129:3)
            at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
          errorLabelSet: Set(1) {
            'ResetPool'
          },
          beforeHandshake: false,
          [cause]: Error: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-02.vvozqg2.mongodb.net
              at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {
            errno: -3008,
            code: 'ENOTFOUND',
            syscall: 'getaddrinfo',
            hostname: 'ac-9ru3epx-shard-00-02.vvozqg2.mongodb.net'
          }
        },
        topologyVersion: null,
        setName: null,
        setVersion: null,
        electionId: null,
        logicalSessionTimeoutMinutes: null,
        maxMessageSizeBytes: null,
        maxWriteBatchSize: null,
        maxBsonObjectSize: null,
        primary: null,
        me: null,
        '$clusterTime': null,
        iscryptd: false
      },
      'ac-9ru3epx-shard-00-01.vvozqg2.mongodb.net:27017' => ServerDescription {
        address: 'ac-9ru3epx-shard-00-01.vvozqg2.mongodb.net:27017',
        type: 'Unknown',
        hosts: [],
        passives: [],
        arbiters: [],
        tags: {},
        minWireVersion: 0,
        maxWireVersion: 0,
        roundTripTime: -1,
        minRoundTripTime: 0,
        lastUpdateTime: 22622242,
        lastWriteDate: 0,
        error: MongoNetworkError: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-01.vvozqg2.mongodb.net
            at TLSSocket.<anonymous> (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cmap\connect.ts:394:16)
            at Object.onceWrapper (node:events:633:26)
            at TLSSocket.emit (node:events:518:28)
            at emitErrorNT (node:internal/streams/destroy:170:8)
            at emitErrorCloseNT (node:internal/streams/destroy:129:3)
            at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
          errorLabelSet: Set(1) {
            'ResetPool'
          },
          beforeHandshake: false,
          [cause]: Error: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-01.vvozqg2.mongodb.net
              at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {
            errno: -3008,
            code: 'ENOTFOUND',
            syscall: 'getaddrinfo',
            hostname: 'ac-372463epx-shard-00-01.vvozqg2.mongodb.net'
          }
        },
        topologyVersion: null,
        setName: null,
        setVersion: null,
        electionId: null,
        logicalSessionTimeoutMinutes: null,
        maxMessageSizeBytes: null,
        maxWriteBatchSize: null,
        maxBsonObjectSize: null,
        primary: null,
        me: null,
        '$clusterTime': null,
        iscryptd: false
      }
    },
    stale: false,
    compatible: true,
    heartbeatFrequencyMS: 10000,
    localThresholdMS: 15,
    setName: 'atlas-epvsgy-shard-0',
    maxElectionId: new ObjectId('7fffffff00000000000003b4'),   
    maxSetVersion: 316,
    commonWireVersion: 0,
    logicalSessionTimeoutMinutes: null
  },
  code: undefined,
  [cause]: MongoNetworkError: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net
      at TLSSocket.<anonymous> (F:\AIUB\Personal_project\Cirql2\cirql\cirql-backend\node_modules\.pnpm\mongodb@6.16.0\node_modules\mongodb\src\cmap\connect.ts:394:16)
      at Object.onceWrapper (node:events:633:26)
      at TLSSocket.emit (node:events:518:28)
      at emitErrorNT (node:internal/streams/destroy:170:8)     
      at emitErrorCloseNT (node:internal/streams/destroy:129:3)      at process.processTicksAndRejections (node:internal/process/task_queues:90:21) {
    errorLabelSet: Set(1) {
      'ResetPool'
    },
    beforeHandshake: false,
    [cause]: Error: getaddrinfo ENOTFOUND ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net
        at GetAddrInfoReqWrap.onlookupall [as oncomplete] (node:dns:122:26) {
      errno: -3008,
      code: 'ENOTFOUND',
      syscall: 'getaddrinfo',
      hostname: 'ac-9ru3epx-shard-00-00.vvozqg2.mongodb.net'   
    }
  }
}
Error: [apiClient] Response Error: 500 for /support/tickets/685f075b98a461cd396f28e0/messages {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)

    at async handleReply (http://localhost:3000/_next/static/chunks/_710e3dc4._.js:2375:13)
    
    admin can close tickets, user got closed ticket, reinstated email and notification. by clicking notification redirected to http://localhost:3000/dashboard instead of http://localhost:3000/home
//
test -2
Error: [apiClient] Response Error: 400 for /settings/me {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)
    at async updateMySettings (http://localhost:3000/_next/static/chunks/_b6deeab3._.js:1050:22)
    at async Body.useMemo[debouncedSaveSettings] (http://localhost:3000/_next/static/chunks/_1d57d05e._.js:3357:47)
    AxiosError: Request failed with status code 400
    at settle (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:4337:16)
    at XMLHttpRequest.onloadend (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:4841:224)
    at Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5566:49)
    at async updateMySettings (http://localhost:3000/_next/static/chunks/_b6deeab3._.js:1050:22)
    at async Body.useMemo[debouncedSaveSettings] (http://localhost:3000/_next/static/chunks/_1d57d05e._.js:3357:47)
    Error: [apiClient] Response Error: 404 for /settings/user/685de0739301179f8e91e207 {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)
    at async useUserSettings.useEffect.fetchData (http://localhost:3000/_next/static/chunks/_943474c4._.js:7028:42)
    Error: Could not load user settings. Request failed with status code 404

Error: [apiClient] Response Error: 404 for /settings/user/685de0739301179f8e91e207 {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)
    at async useUserSettings.useEffect.fetchData (http://localhost:3000/_next/static/chunks/_943474c4._.js:7028:42)
    same log-in/2fa problem. get mail but sign-in is redirected
     Compiling /log-in/2fa ...
 ✓ Compiled /log-in/2fa in 1366ms
 GET /log-in/2fa?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2ODVkZGE2OGVjOGRiMWY4ODUxZmE5YTAiLCJpc1R3b0ZhY3RvckF1dGhlbnRpY2F0aW9uQ29tcGxldGUiOmZhbHNlLCJpYXQiOjE3NTEwNjIxNzAsImV4cCI6MTc1MTA2MjQ3MH0.ebsJpwd0WXV2DxrDgFQnSEqTnubIwH7x5EggQ_d6Pp8 200 in 1498ms
 GET /sign-in 200 in 140ms
 GET /sign-in 200 in 181ms
 GET /log-in/2fa 200 in 155ms
 GET /sign-in 200 in 159ms
 GET /sign-in 200 in 155ms
 ○ Compiling /_not-found/page ...
 ✓ Compiled /_not-found/page in 2.1s
 GET /login/sign-in 404 in 2183ms
Error: Could not load user settings. Request failed with status code 404

Error: [apiClient] Response Error: 404 for /settings/user/685ddd458fa7d6a5fa5e453d {}
    at createConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:882:71)
    at handleConsoleError (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1058:54)
    at console.error (http://localhost:3000/_next/static/chunks/f07ee_next_dist_client_5cf5dcf9._.js:1223:57)
    at http://localhost:3000/_next/static/chunks/_af665404._.js:75:21
    at async Axios.request (http://localhost:3000/_next/static/chunks/node_modules__pnpm_f0df96f1._.js:5562:20)
    at async useUserSettings.useEffect.fetchData (http://localhost:3000/_next/static/chunks/_943474c4._.js:7028:42)